/**
 * Copyright (c) 2026, WSO2 LLC. (https://www.wso2.com).
 *
 * WSO2 LLC. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import {useMemo, useCallback, useState, type JSX} from 'react';
import {useNavigate} from 'react-router';
import {useLogger} from '@thunder/logger/react';
import {
  Box,
  Avatar,
  Chip,
  IconButton,
  Typography,
  Menu,
  MenuItem,
  ListItemIcon,
  ListItemText,
  DataGrid,
  useTheme,
} from '@wso2/oxygen-ui';
import {AppWindow, EllipsisVertical, Eye, Trash2} from '@wso2/oxygen-ui-icons-react';
import {useTranslation} from 'react-i18next';
import useGet{{pascalCase featureName}}s from '../api/useGet{{pascalCase featureName}}s';
import type Basic{{pascalCase featureName}} from '../models/{{camelCase featureName}}';

export default function {{pascalCase featureName}}List(): JSX.Element {
  const theme = useTheme();
  const navigate = useNavigate();
  const {t} = useTranslation();
  const logger = useLogger('{{pascalCase featureName}}List');
  const {data, isLoading, error} = useGet{{pascalCase featureName}}s();

  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);
  const [selectedItem, setSelectedItem] = useState<Basic{{pascalCase featureName}} | null>(null);

  const handleMenuClick = useCallback((event: React.MouseEvent<HTMLElement>, item: Basic{{pascalCase featureName}}) => {
    setAnchorEl(event.currentTarget);
    setSelectedItem(item);
  }, []);

  const handleMenuClose = useCallback(() => {
    setAnchorEl(null);
    setSelectedItem(null);
  }, []);

  const handleView = useCallback((id: string) => {
    navigate('/{{kebabCase featureName}}s/' + id);
    handleMenuClose();
  }, [navigate, handleMenuClose]);

  const handleDelete = useCallback((id: string) => {
    logger.info('Delete {{camelCase featureName}} requested for ID: ' + id);
    // TODO: Implement delete functionality
    handleMenuClose();
  }, [logger, handleMenuClose]);

  const columns = useMemo(() => [
    {
      field: 'name',
      headerName: t('{{camelCase featureName}}s:listing.columns.name'),
      flex: 1,
      minWidth: 200,
      renderCell: (params: DataGrid.GridRenderCellParams<Basic{{pascalCase featureName}}>) => (
        <Box sx=\{{display: 'flex', alignItems: 'center', gap: 1}}>
          <Avatar sx=\{{width: 24, height: 24}}>
            <AppWindow />
          </Avatar>
          <Typography variant="body2" fontWeight="medium">
            {params.value}
          </Typography>
        </Box>
      ),
    },
    {
      field: 'description',
      headerName: t('{{camelCase featureName}}s:listing.columns.description'),
      flex: 1.5,
      minWidth: 250,
      renderCell: (params: DataGrid.GridRenderCellParams<Basic{{pascalCase featureName}}>) => (
        <Typography variant="body2" color="text.secondary" noWrap>
          {params.value}
        </Typography>
      ),
    },
    {
      field: 'createdAt',
      headerName: t('{{camelCase featureName}}s:listing.columns.created'),
      flex: 0.8,
      minWidth: 120,
      renderCell: (params: DataGrid.GridRenderCellParams<Basic{{pascalCase featureName}}>) => (
        <Typography variant="body2" color="text.secondary">
          {params.value ? new Date(params.value).toLocaleDateString() : '-'}
        </Typography>
      ),
    },
    {
      field: 'actions',
      headerName: t('common:actions'),
      width: 80,
      sortable: false,
      renderCell: (params: DataGrid.GridRenderCellParams<Basic{{pascalCase featureName}}>) => (
        <IconButton
          size="small"
          onClick=\{{(event) => handleMenuClick(event, params.row)}}
          aria-label=\{{t('{{camelCase featureName}}s:listing.actions.more')}}
        >
          <EllipsisVertical />
        </IconButton>
      ),
    },
  ], [t, handleMenuClick]);

  if (error) {
    logger.error('Failed to load {{camelCase featureName}}s', error);
    return (
      <Box sx=\{{p: 2, textAlign: 'center'}}>
        <Typography color="error">
          {t('{{camelCase featureName}}s:listing.error.loadFailed')}
        </Typography>
      </Box>
    );
  }

  return (
    <Box sx=\{{height: '100%', width: '100%'}}>
      <DataGrid
        rows=\{{data?.{{camelCase featureName}}s || []}}
        columns=\{{columns}}
        loading=\{{isLoading}}
        autoHeight
        disableRowSelectionOnClick
        sx=\{{
          border: 'none',
          '& .MuiDataGrid-cell': {
            borderBottom: `1px solid $\{theme.palette.divider}`,
          },
          '& .MuiDataGrid-columnHeaders': {
            backgroundColor: theme.palette.background.default,
            borderBottom: `1px solid $\{theme.palette.divider}`,
          },
        }}
      />

      <Menu
        anchorEl=\{{anchorEl}}
        open=\{{Boolean(anchorEl)}}
        onClose=\{{handleMenuClose}}
        anchorOrigin=\{{
          vertical: 'bottom',
          horizontal: 'right',
        }}
        transformOrigin=\{{
          vertical: 'top',
          horizontal: 'right',
        }}
      >
        <MenuItem onClick=\{{() => selectedItem && handleView(selectedItem.id)}}>
          <ListItemIcon>
            <Eye size=\{{16}} />
          </ListItemIcon>
          <ListItemText>{t('common:view')}</ListItemText>
        </MenuItem>
        <MenuItem onClick=\{{() => selectedItem && handleDelete(selectedItem.id)}}>
          <ListItemIcon>
            <Trash2 size=\{{16}} />
          </ListItemIcon>
          <ListItemText>{t('common:delete')}</ListItemText>
        </MenuItem>
      </Menu>
    </Box>
  );
}
